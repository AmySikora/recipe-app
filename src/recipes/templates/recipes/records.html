{% extends 'recipes/base.html' %}
{% load static %}
{% block title %}Search Recipes{% endblock %}

{% block content %}
<div class="container">
    <h1>Search Recipes</h1>

    <form method="POST" id="search-form">
        {% csrf_token %}
        {{ form.search_term.label_tag }}
        {{ form.search_term }}

        <button type="submit">üîç Search</button>

        <label for="chart-type">Select Chart Type:</label>
        <input type="hidden" name="chart_type" id="chart-type" value="{{ form.chart_type.value|default_if_none:'' }}">

        <div class="chart-icon-group">
            <div class="chart-icon-wrapper">
                <img src="{% static 'icons/bar-chart.png' %}" alt="Bar Chart" class="chart-icon {% if form.chart_type.value == '#1' %}selected{% endif %}" data-chart="#1">
                <div>Bar</div>
            </div>
            <div class="chart-icon-wrapper">
                <img src="{% static 'icons/pie-chart.png' %}" alt="Pie Chart" class="chart-icon {% if form.chart_type.value == '#2' %}selected{% endif %}" data-chart="#2">
                <div>Pie</div>
            </div>
            <div class="chart-icon-wrapper">
                <img src="{% static 'icons/line-graph.png' %}" alt="Line Chart" class="chart-icon {% if form.chart_type.value == '#3' %}selected{% endif %}" data-chart="#3">
                <div>Line</div>
            </div>
        </div>
    </form>

    {% if recipes_df %}
        <h2>Recipes:</h2>
        <div class="result-table">{{ recipes_df|safe }}</div>
    {% endif %}

    {% if chart %}
        <div class="chart">
            <h2>Chart Visualization:</h2>
            <img src="data:image/png;base64,{{ chart }}" alt="Chart">
        </div>
    {% endif %}
</div>
{% endblock %}

<script>
    const icons = document.querySelectorAll('.chart-icon');
    const chartTypeInput = document.getElementById('chart-type');
    const form = document.getElementById('search-form');

    icons.forEach(icon => {
        icon.addEventListener('click', () => {
            icons.forEach(i => i.classList.remove('selected'));
            icon.classList.add('selected');
            chartTypeInput.value = icon.dataset.chart;
            form.submit();
        });
    });
</script>
